<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecuador: Datos Reales vs Pronósticos del FMI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: #f0f4f8;
            color: #1a202c;
        }
        .header {
            background: linear-gradient(135deg, #1a365d 0%, #2b6cb0 100%);
            color: white;
            padding: 2rem 2rem 1.5rem;
            text-align: center;
        }
        .header h1 { font-size: 1.6rem; font-weight: 700; margin-bottom: 0.3rem; }
        .header p { font-size: 0.9rem; opacity: 0.85; }
        .container { max-width: 1100px; margin: 0 auto; padding: 1.5rem; }
        .controls {
            background: white;
            border-radius: 12px;
            padding: 1.2rem 1.5rem;
            margin-bottom: 1.2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            align-items: flex-start;
        }
        .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-group label {
            font-size: 0.75rem; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.05em; color: #4a5568;
        }
        .variable-select {
            padding: 0.5rem 1rem; border: 2px solid #e2e8f0; border-radius: 8px;
            font-size: 0.95rem; font-weight: 500; background: white; cursor: pointer;
            min-width: 280px; transition: border-color 0.2s;
        }
        .variable-select:focus { outline: none; border-color: #3182ce; }
        .vintage-toggles { display: flex; flex-wrap: wrap; gap: 0.4rem; }
        .vintage-btn {
            padding: 0.4rem 0.8rem; border: 2px solid; border-radius: 20px;
            font-size: 0.8rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s; background: white;
        }
        .vintage-btn.active { color: white; }
        .vintage-btn:hover { transform: scale(1.05); }
        .chart-container {
            background: white; border-radius: 12px; padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 1.2rem;
        }
        .chart-wrapper { position: relative; height: 480px; }
        .info-bar {
            background: white; border-radius: 12px; padding: 1rem 1.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1); font-size: 0.82rem;
            color: #4a5568; line-height: 1.6;
        }
        .info-bar strong { color: #1a365d; }
        .legend-note {
            text-align: center; font-size: 0.8rem; color: #718096;
            margin-top: 0.5rem; font-style: italic;
        }
        .btn-group-actions { display: flex; gap: 0.4rem; margin-left: auto; }
        .btn-action {
            padding: 0.35rem 0.7rem; border: 1px solid #cbd5e0; border-radius: 6px;
            font-size: 0.75rem; cursor: pointer; background: #edf2f7;
            color: #4a5568; font-weight: 500; transition: all 0.15s;
        }
        .btn-action:hover { background: #e2e8f0; }
        @media (max-width: 768px) {
            .controls { flex-direction: column; }
            .variable-select { min-width: 100%; }
            .chart-wrapper { height: 350px; }
            .btn-group-actions { margin-left: 0; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Ecuador: Datos Reales vs Pronósticos del FMI</h1>
    <p>Comparación de distintas versiones de Staff Reports</p>
</div>

<div class="container">
    <div class="controls">
        <div class="control-group">
            <label>Variable</label>
            <select class="variable-select" id="varSelect"></select>
        </div>
        <div class="control-group">
            <label>Vintages del FMI</label>
            <div class="vintage-toggles" id="vintageToggles"></div>
        </div>
        <div class="btn-group-actions">
            <button class="btn-action" onclick="toggleAll(true)">Todos</button>
            <button class="btn-action" onclick="toggleAll(false)">Ninguno</button>
        </div>
    </div>

    <div class="chart-container">
        <div class="chart-wrapper">
            <canvas id="mainChart"></canvas>
        </div>
        <p class="legend-note">Línea negra sólida = datos reales &nbsp;|&nbsp; Líneas punteadas = pronósticos del FMI</p>
    </div>

    <div class="info-bar">
        <strong>Fuentes:</strong> IMF Country Report No. 19/79, IMF Country Report No. 20/325, IMF Country Report No. 21/228, IMF Country Report No. 22/378, IMF Country Report No. 24/357, IMF Country Report No. 25/341.
        <br><strong>Nota:</strong> Para la construcción de la información se utiliza: Table 1. Ecuador: Selected Economic and Financial Indicators.
    </div>
</div>

<script>
const actual = {
    "Real GDP (%)": {2014:3.8,2015:0.1,2016:-1.2,2017:2.4,2018:1.3,2019:0.0,2020:-7.8,2021:4.2,2022:6.2,2023:2.0,2024:-2.0},
    "Inflación promedio (%)": {2014:3.6,2015:4.0,2016:1.7,2017:0.4,2018:-0.2,2019:0.3,2020:-0.3,2021:0.1,2022:3.5,2023:2.2,2024:1.5},
    "Cuenta Corriente (% PIB)": {2014:-0.7,2015:-2.2,2016:1.3,2017:-0.4,2018:-1.2,2019:-0.1,2020:2.7,2021:2.9,2022:1.8,2023:1.9,2024:5.7},
    "Balance Fiscal NFPS (% PIB)": {2014:-5.2,2015:-6.1,2016:-8.2,2017:-4.5,2018:-2.1,2019:-2.7,2020:-7.1,2021:-1.6,2022:0.0,2023:-3.5,2024:-1.3},
    "Deuda Pública (% PIB)": {2014:27.1,2015:33.8,2016:43.2,2017:44.6,2018:49.1,2019:51.4,2020:60.9,2021:62.3,2022:57.0,2023:54.3,2024:53.8},
    "Precio Petróleo Ecuador (USD/bbl)": {2014:84.0,2015:42.1,2016:34.5,2017:45.6,2018:60.6,2019:55.1,2020:35.6,2021:62.0,2022:85.8,2023:68.0,2024:68.5},
    "PIB Nominal (USD mn)": {2014:101726,2015:99290,2016:99938,2017:104296,2018:107562,2019:108108,2020:99291,2021:106166,2022:116586,2023:121147,2024:124676},
    "Reservas Internacionales (USD mn)": {2014:3762,2015:2351,2016:4216,2017:2006,2018:2158,2019:2933,2020:7133,2021:7898,2022:8459,2023:4455,2024:6908},
};

const vintages = {
    "Mar-2019": {
        color: "#2563eb", projStart: 2019,
        data: {
            "Real GDP (%)": {2019:-0.5,2020:0.2,2021:1.2,2022:2.7,2023:2.3},
            "Inflación promedio (%)": {2019:0.6,2020:1.2,2021:1.6,2022:1.3,2023:1.1},
            "Cuenta Corriente (% PIB)": {2019:0.4,2020:1.4,2021:1.5,2022:1.5,2023:1.7},
            "Balance Fiscal NFPS (% PIB)": {2019:0.0,2020:3.8,2021:2.9,2022:2.8,2023:2.9},
            "Deuda Pública (% PIB)": {2019:49.2,2020:46.8,2021:45.2,2022:40.8,2023:36.6},
            "Precio Petróleo Ecuador (USD/bbl)": {2019:47.8,2020:48.7,2021:49.4,2022:50.0,2023:50.7},
            "PIB Nominal (USD mn)": {2019:106289,2020:107730,2021:110571,2022:114783,2023:118502},
            "Reservas Internacionales (USD mn)": {2019:4999,2020:7761,2021:11397,2022:11845,2023:12944},
        }
    },
    "Dic-2020": {
        color: "#ea580c", projStart: 2020,
        data: {
            "Real GDP (%)": {2020:-9.5,2021:3.5,2022:1.3,2023:1.7,2024:2.0,2025:2.3},
            "Inflación promedio (%)": {2020:-0.3,2021:1.0,2022:2.4,2023:1.4,2024:1.0,2025:1.0},
            "Cuenta Corriente (% PIB)": {2020:-0.6,2021:1.0,2022:1.6,2023:2.0,2024:2.1,2025:2.0},
            "Balance Fiscal NFPS (% PIB)": {2020:-7.8,2021:-2.8,2022:0.6,2023:1.9,2024:2.3,2025:2.2},
            "Deuda Pública (% PIB)": {2020:66.4,2021:66.2,2022:64.9,2023:61.9,2024:60.1,2025:56.4},
            "Precio Petróleo Ecuador (USD/bbl)": {2020:34.7,2021:37.1,2022:38.3,2023:39.3,2024:40.1,2025:40.9},
            "PIB Nominal (USD mn)": {2020:94297,2021:99197,2022:102841,2023:106012,2024:109458,2025:113362},
            "Reservas Internacionales (USD mn)": {2020:5660,2021:6826,2022:8930,2023:10814,2024:13040,2025:13786},
        }
    },
    "Oct-2021": {
        color: "#16a34a", projStart: 2021,
        data: {
            "Real GDP (%)": {2021:2.8,2022:3.5,2023:2.5,2024:2.6,2025:2.8,2026:2.8},
            "Inflación promedio (%)": {2021:1.0,2022:2.1,2023:1.8,2024:1.5,2025:1.3,2026:1.0},
            "Cuenta Corriente (% PIB)": {2021:1.0,2022:1.7,2023:1.9,2024:2.0,2025:2.1,2026:2.0},
            "Balance Fiscal NFPS (% PIB)": {2021:-2.3,2022:0.1,2023:1.2,2024:1.4,2025:1.4,2026:1.0},
            "Deuda Pública (% PIB)": {2021:61.0,2022:59.9,2023:57.9,2024:56.2,2025:52.9,2026:49.6},
            "Precio Petróleo Ecuador (USD/bbl)": {2021:37.1,2022:59.8,2023:55.0,2024:52.3,2025:50.5,2026:49.3},
            "PIB Nominal (USD mn)": {2021:99197,2022:104483,2023:109975,2024:114076,2025:118502,2026:123202},
            "Reservas Internacionales (USD mn)": {2021:7196,2022:8427,2023:9908,2024:11529,2025:13443,2026:15021},
        }
    },
    "Nov-2022": {
        color: "#dc2626", projStart: 2022,
        data: {
            "Real GDP (%)": {2022:2.7,2023:3.0,2024:2.8,2025:2.8,2026:2.8,2027:2.8},
            "Inflación promedio (%)": {2022:3.5,2023:2.5,2024:1.5,2025:1.5,2026:1.5,2027:1.5},
            "Cuenta Corriente (% PIB)": {2022:2.1,2023:1.8,2024:1.9,2025:2.0,2026:2.0,2027:2.0},
            "Balance Fiscal NFPS (% PIB)": {2022:1.0,2023:1.6,2024:2.0,2025:2.1,2026:2.2,2027:1.9},
            "Deuda Pública (% PIB)": {2022:58.3,2023:55.6,2024:53.1,2025:49.3,2026:45.3,2027:42.0},
            "Precio Petróleo Ecuador (USD/bbl)": {2022:87.8,2023:76.0,2024:72.6,2025:69.7,2026:66.4,2027:63.8},
            "PIB Nominal (USD mn)": {2022:116076,2023:121106,2024:126093,2025:131036,2026:136175,2027:141515},
            "Reservas Internacionales (USD mn)": {2022:9693,2023:12050,2024:14543,2025:16360,2026:17836,2027:19001},
        }
    },
    "Dic-2024": {
        color: "#7c3aed", projStart: 2024,
        data: {
            "Real GDP (%)": {2024:-0.4,2025:1.6,2026:1.8,2027:2.4,2028:2.5,2029:2.5},
            "Inflación promedio (%)": {2024:1.9,2025:2.2,2026:1.6,2027:1.5,2028:1.5,2029:1.5},
            "Cuenta Corriente (% PIB)": {2024:4.4,2025:3.1,2026:2.8,2027:2.6,2028:2.5,2029:2.5},
            "Balance Fiscal NFPS (% PIB)": {2024:-1.8,2025:-1.3,2026:-0.2,2027:0.0,2028:0.5,2029:0.8},
            "Deuda Pública (% PIB)": {2024:56.8,2025:56.8,2026:55.7,2027:54.4,2028:52.5,2029:50.0},
            "Precio Petróleo Ecuador (USD/bbl)": {2024:68.5,2025:63.2,2026:61.4,2027:59.6,2028:58.5,2029:57.9},
            "PIB Nominal (USD mn)": {2024:120433,2025:125038,2026:129175,2027:134226,2028:139645,2029:145328},
            "Reservas Internacionales (USD mn)": {2024:7648,2025:10544,2026:12676,2027:14679,2028:16678,2029:18740},
        }
    },
    "Dic-2025": {
        color: "#92400e", projStart: 2025,
        data: {
            "Real GDP (%)": {2025:3.4,2026:2.2,2027:2.4,2028:2.6,2029:2.8,2030:3.0},
            "Inflación promedio (%)": {2025:0.9,2026:2.8,2027:1.5,2028:1.5,2029:1.5,2030:1.5},
            "Cuenta Corriente (% PIB)": {2025:5.1,2026:4.1,2027:3.4,2028:3.1,2029:2.8,2030:2.8},
            "Balance Fiscal NFPS (% PIB)": {2025:-1.2,2026:0.0,2027:0.8,2028:1.3,2029:1.3,2030:1.3},
            "Deuda Pública (% PIB)": {2025:53.2,2026:51.4,2027:49.6,2028:47.7,2029:45.2,2030:42.2},
            "Precio Petróleo Ecuador (USD/bbl)": {2025:58.9,2026:54.1,2027:54.1,2028:54.9,2029:55.7,2030:56.3},
            "PIB Nominal (USD mn)": {2025:130548,2026:136083,2027:141655,2028:147553,2029:153966,2030:160999},
            "Reservas Internacionales (USD mn)": {2025:10290,2026:13220,2027:16448,2028:19552,2029:23125,2030:26094},
        }
    }
};

// STATE
const variableNames = Object.keys(actual);
let currentVar = "Reservas Internacionales (USD mn)";
let activeVintages = new Set(Object.keys(vintages));
let chart = null;

// UI SETUP
const varSelect = document.getElementById('varSelect');
variableNames.forEach(v => {
    const opt = document.createElement('option');
    opt.value = v; opt.textContent = v;
    varSelect.appendChild(opt);
});
varSelect.value = currentVar;
varSelect.addEventListener('change', () => { currentVar = varSelect.value; updateChart(); });

const togglesDiv = document.getElementById('vintageToggles');
Object.entries(vintages).forEach(([name, v]) => {
    const btn = document.createElement('button');
    btn.className = 'vintage-btn active';
    btn.textContent = name;
    btn.dataset.vintage = name;
    btn.style.borderColor = v.color;
    btn.style.backgroundColor = v.color;
    btn.style.color = 'white';
    btn.addEventListener('click', () => {
        if (activeVintages.has(name)) {
            activeVintages.delete(name);
            btn.classList.remove('active');
            btn.style.backgroundColor = 'white';
            btn.style.color = v.color;
        } else {
            activeVintages.add(name);
            btn.classList.add('active');
            btn.style.backgroundColor = v.color;
            btn.style.color = 'white';
        }
        updateChart();
    });
    togglesDiv.appendChild(btn);
});

function toggleAll(on) {
    Object.keys(vintages).forEach(name => {
        const btn = togglesDiv.querySelector(`[data-vintage="${name}"]`);
        if (on) {
            activeVintages.add(name);
            btn.classList.add('active');
            btn.style.backgroundColor = vintages[name].color;
            btn.style.color = 'white';
        } else {
            activeVintages.delete(name);
            btn.classList.remove('active');
            btn.style.backgroundColor = 'white';
            btn.style.color = vintages[name].color;
        }
    });
    updateChart();
}

// CHART
function updateChart() {
    const actualData = actual[currentVar] || {};
    const allYears = new Set(Object.keys(actualData).map(Number));

    Object.entries(vintages).forEach(([name, v]) => {
        if (activeVintages.has(name) && v.data[currentVar])
            Object.keys(v.data[currentVar]).forEach(y => allYears.add(Number(y)));
    });

    const years = [...allYears].sort((a, b) => a - b);
    const labels = years.map(String);
    const datasets = [];

    // Actual
    datasets.push({
        label: 'Datos Reales',
        data: years.map(y => actualData[y] !== undefined ? actualData[y] : null),
        borderColor: '#000000',
        backgroundColor: '#000000',
        borderWidth: 3,
        pointRadius: 4,
        pointHoverRadius: 6,
        tension: 0.1,
        spanGaps: false,
        order: 0,
    });

    // Forecasts
    Object.entries(vintages).forEach(([name, v]) => {
        if (!activeVintages.has(name) || !v.data[currentVar]) return;
        const fData = v.data[currentVar];
        const connectYear = v.projStart - 1;

        const seriesData = years.map(y => {
            if (y === connectYear && actualData[y] !== undefined) return actualData[y];
            if (fData[y] !== undefined) return fData[y];
            return null;
        });

        datasets.push({
            label: 'Pron. ' + name,
            data: seriesData,
            borderColor: v.color,
            backgroundColor: v.color + '20',
            borderWidth: 2,
            borderDash: [6, 4],
            pointRadius: 2,
            pointHoverRadius: 5,
            tension: 0.1,
            spanGaps: false,
            order: 1,
        });
    });

    if (chart) chart.destroy();

    chart = new Chart(document.getElementById('mainChart').getContext('2d'), {
        type: 'line',
        data: { labels, datasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                title: {
                    display: true, text: currentVar,
                    font: { size: 16, weight: 'bold' }, color: '#1a365d',
                    padding: { bottom: 15 }
                },
                legend: {
                    position: 'top',
                    labels: { usePointStyle: true, pointStyle: 'line', padding: 15, font: { size: 11 } }
                },
                tooltip: {
                    backgroundColor: 'rgba(26,54,93,0.95)',
                    titleFont: { size: 13, weight: 'bold' },
                    bodyFont: { size: 12 },
                    padding: 12, cornerRadius: 8,
                    callbacks: {
                        label: function(ctx) {
                            if (ctx.raw === null) return null;
                            const val = Math.abs(ctx.raw) >= 1000 ?
                                ctx.raw.toLocaleString('es-EC') : ctx.raw.toFixed(1);
                            return '  ' + ctx.dataset.label + ': ' + val;
                        }
                    }
                }
            },
            scales: {
                x: { grid: { color: 'rgba(0,0,0,0.06)' }, ticks: { font: { size: 11 } } },
                y: { grid: { color: 'rgba(0,0,0,0.08)' }, ticks: { font: { size: 11 } } }
            }
        }
    });
}

updateChart();
</script>
</body>
</html>
